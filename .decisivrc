#!/bin/bash
SYSTEM_TYPE=$(uname -s)

# Load Decisiv configs
source ~/code/decisiv/.profile

# Okta aws
source "$HOME/.okta/bash_functions"
# PATH="$HOME/.okta/bin:$PATH"

## Teleport shortcuts
alias dcvlogin="tsh --proxy=decisiv.sh:443 login --auth=okta"

# Ex dcvls builder qa
dcvls() {
	tsh ls app=$1,env=$2
}

# Ex tshd builder-app-dev-1.dev.decisivapps.com
# Ex2 tshd builder-app-dev-1.dev.decisivapps.com tmux a
dcvsh() {
  tsh ssh --proxy=decisiv.sh:443 developers@$1 $2
}

dcvshd() {
  tsh ssh --proxy=decisiv.sh:443 developers@$1.decisivapps.com
}

# run decisiiv services
dcvserv() {
  (cd ~/code/decisiv/decisiv-services && be services bootstrap && be services start)
}

# start pricing
dcvstart() {
  dcvstop
  printf "Starting Docker for Mac";

  open -a Docker;

  while [[ -z "$(! docker stats --no-stream 2> /dev/null)" ]];
  do printf ".";
    sleep 1
  done

  dcvserv
  brew services start memcached
  brew services start redis
  brew services start postgresql@9.6

  (tail -f ~/Library/Logs/puma-dev.log 
       \ -f ~/code/decisiv/pricing/log/development.log
       \ -f ~/code/decisiv/portal/log/development.log)
}

# stop pricing
dcvstop() {
  osascript -e 'quit app "Docker"'
  puma-dev -stop
  brew services stop memcached
  brew services stop redis
  brew services stop postgresql@9.6
  (cd ~/code/decisiv/decisiv-services && be services stop)
}

# if [ "$SYSTEM_TYPE" = "Darwin" ]; then
#   export PATH="/usr/local/opt/postgresql@9.6/bin:$PATH"
# fi
